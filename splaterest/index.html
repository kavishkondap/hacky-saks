<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://quadjr.github.io/aframe-gaussian-splatting/index.js"></script>
  </head>
  <body>
  <a-scene renderer="antialias: false" stats>
    <a-entity camera position="0 1.6 0"></a-entity>
    <a-entity id="rotating-entity" position="0 1.6 -2.0" animation="property: rotation; to: 0 360 0; dur: 10000; easing: linear; loop: true">
      <a-sphere position="0 0 0.5" radius="0.5" color="#FFFFFF"></a-sphere>
      <a-sphere position="0 0 -0.5" radius="0.5" color="#EF2D5E"></a-sphere>
    </a-entity>
    <a-entity id="right-controller" meta-touch-controls="hand: right" thumbstick-logging></a-entity>
    <a-entity id="splat-viewer" gaussian_splatting="src: https://huggingface.co/cakewalk/splat-data/resolve/main/train.splat;" rotation="0 0 0" position="0 1.5 -2"></a-entity>
  </a-scene>

  <script>
    document.querySelector('[camera]').setAttribute('position', '0 0 0');
    document.querySelector('#rotating-entity').setAttribute('position', '0 .2 -2.0');
    const urlParams = new URLSearchParams(window.location.search);
    const splat = document.getElementById('splat-viewer');
    if (urlParams.has('src')) {
        const sourceID = urlParams.get('src');
        splat.setAttribute('gaussian_splatting', "src: https://calhacks-hacky-saks.s3.us-east-2.amazonaws.com/" + sourceID + ";");
    }
    
    AFRAME.registerComponent('thumbstick-logging',{
      init: function () {
        this.logThumbstick = this.logThumbstick.bind(this);
        this.el.addEventListener('thumbstickmoved', this.logThumbstick);
      },
      logThumbstick: function (evt) {
        if (evt.detail.y > 0.95) { console.log("DOWN"); }
        if (evt.detail.y < -0.95) { console.log("UP"); }
        if (evt.detail.x < -0.95) { console.log("LEFT"); }
        if (evt.detail.x > 0.95) { console.log("RIGHT"); }

        if (evt.detail.x > 0.7 || evt.detail.x < -0.7 || evt.detail.y > 0.7 || evt.detail.y < -0.7) {

          camera = document.querySelector('[camera]');
          position = camera.getAttribute('position');
          console.log(position);
          camera.setAttribute('position', {
              x: position.x + (evt.detail.x * 0.1),
              y: position.y,
              z: position.z + (evt.detail.y * 0.1)
          });

          document.querySelector('#rotating-entity').setAttribute('position', '0 1.6 -2.0');
        }
      }
    });
  </script>
  
  </body>
</html>